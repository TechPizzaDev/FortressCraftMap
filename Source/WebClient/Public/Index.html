<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<link rel="icon" href="./favicon.png">

	<link href="./Style/Initial-Loader.css" rel="stylesheet" type="text/css" />
	<link href="./Style/Index.css" rel="stylesheet" type="text/css" />
	<link href="./Style/Icons.css" rel="stylesheet" type="text/css" />
</head>
<body>
	<div id="mainContainer" class="hidden">
		<div>
			<canvas id="canvasLayer0" class="renderCanvas"></canvas>
			<canvas id="canvasLayer1" class="renderCanvas"></canvas>
		</div>

		<div id="debugInfoContainer">
			<div id="fpsCounter" title="Frames per second"> <span></span> </div>
			<div id="debugInfo" class="hidden"> <table></table> </div>
		</div>

		<div id="fullscreenButton" title="Fullscreen toggle">
			<div class="icon-fullscreen"></div>
		</div>
	</div>

	<div id="initial-loader">
		<div class="sk-cube-grid">
			<div class="sk-cube sk-cube1"></div>
			<div class="sk-cube sk-cube2"></div>
			<div class="sk-cube sk-cube3"></div>
			<div class="sk-cube sk-cube4"></div>
			<div class="sk-cube sk-cube5"></div>
			<div class="sk-cube sk-cube6"></div>
			<div class="sk-cube sk-cube7"></div>
			<div class="sk-cube sk-cube8"></div>
			<div class="sk-cube sk-cube9"></div>
		</div>

		<div id="loading-bar">
			<div id="loading-bar-percentage" style="width: 0%">
				<span>Loading runtime...</span>
			</div>
		</div>
	</div>

	<script>
		let appContentList; // used by ContentRegistry
		let appUpdateLoadingProgress; // used by ContentLoadingInfo
	</script>
	<script src="./Script/runtime.js"></script>
	<script src="./Script/bootstrap.js"></script>

	<script>
		const appLoadingProgressBar = document.getElementById("loading-bar-percentage");
		const appLoadingProgressSpan = appLoadingProgressBar.getElementsByTagName("span")[0];

		const assetStatus = {
			percentage: 0,
			bytesDownloaded: 0,
			files: 0,
			totalFiles: appContentList.count
		};

		const scriptsToLoad = [
			"./Script/dependencies.js",
			"./Script/main.js"
		];

		const resourcesToLoad = [...scriptsToLoad];
		
		const appLoadStatus = {
			percentage: 0,
			bytesDownloaded: 0,
			files: 0,
			totalFiles: resourcesToLoad.length
		};

		appUpdateLoadingProgress([appLoadStatus, assetStatus]);

		resourcesToLoad.map(resource => {
			if (resource.startsWith("./Script/")) {
				const scriptNode = document.createElement("script");
				scriptNode.src = resource;
				scriptNode.onload = () => {
					appLoadStatus.percentage += 1 / resourcesToLoad.length;
					appLoadStatus.files++;
					appUpdateLoadingProgress([appLoadStatus, assetStatus]);
				};
				document.documentElement.appendChild(scriptNode);
			}
			else {
				throw new Error(`Could not determine resource type from "${resource}"`);
			}
		});
	</script>

	<!--
	<script src="./Script/dependencies.js"></script>
	<script src="./Script/main.js"></script>
	-->
</body>
</html>
